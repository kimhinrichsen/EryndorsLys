/* styles.css (fuld fil)
   Ændringer for denne version:
   - Tilføjet komplet popup-styling (.lore-overlay-wrap, .lore-popup, animationer) med større vertikal højde.
   - Ingen øvrige layoutændringer fjernet – mentor-række og avatar forbliver som før.
*/

/* ========== ROOT / BASICS ========== */
:root {
  --bg:#0f1518;
  --panel:#1b262c;
  --panel-alt:#22323a;
  --border:#2f434c;
  --text:#e3edf1;
  --text-dim:#9cb3be;
  --accent:#4db07f;
  --accent-glow:#5ddf9c;
  --danger:#d35b52;
  --radius:14px;
  --transition:160ms cubic-bezier(.4,.2,.2,1);
  --scrollbar-track:rgba(255,255,255,0.05);
  --scrollbar-thumb:rgba(255,255,255,0.18);
  font-size:16px;
}
* { box-sizing:border-box; }
html,body { margin:0; padding:0; background:linear-gradient(180deg,#0b1113,#111b20 60%,#0f181c); color:var(--text); font-family:system-ui,Segoe UI,Arial,sans-serif; -webkit-font-smoothing:antialia; }
body.lock-scroll, html.lock-scroll { overflow:hidden; }
img { max-width:100%; height:auto; display:block; }

/* ========== BUTTONS ========== */
.btn, .kro-btn {
  --btn-bg:var(--panel);
  --btn-hover:#294048;
  --btn-active:#203238;
  background:var(--btn-bg);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:10px;
  padding:.55rem .95rem;
  font:500 0.85rem/1 system-ui,Arial,sans-serif;
  cursor:pointer;
  transition:background var(--transition), color var(--transition), border-color var(--transition), transform var(--transition);
  position:relative;
}
.btn:hover, .kro-btn:hover { background:var(--btn-hover); }
.btn:active, .kro-btn:active { background:var(--btn-active); transform:translateY(1px); }
.btn.primary { background:linear-gradient(135deg,#289458,#2fa867); border-color:#2eab68; box-shadow:0 0 0 1px #2fa86755, 0 4px 14px -2px #1d6d4380; }
.btn.primary:hover { background:linear-gradient(135deg,#2ea965,#37bd74); }
.btn.primary:active { background:linear-gradient(135deg,#23804d,#2a945a); }
.btn.ghost { background:transparent; border-color:var(--border); }
.btn.danger { background:#772e2a; border-color:#a44a45; }
.btn.danger:hover { background:#8a3b36; }
.btn.mini { padding:.4rem .6rem; font-size:.72rem; }
.btn.wide { width:100%; }
.btn:disabled { opacity:.55; cursor:not-allowed; }

/* ========== LAYOUT HEADER / AVATAR ========== */
#app { max-width:1200px; margin:0 auto; padding:0 1rem 2rem; }
.top-header {
  display:flex; align-items:center; justify-content:space-between;
  gap:1rem; padding:1rem 0 .75rem; position:relative;
}
.kro-header { font-size:1.25rem; margin:0; letter-spacing:.5px; font-weight:600; color:#f0fafb; text-shadow:0 0 6px rgba(255,255,255,0.15); }
.header-right { display:flex; align-items:center; gap:.5rem; }
.char-header { display:flex; align-items:center; gap:.75rem; min-width:0; }

.char-avatar-wrap {
  width:72px; height:72px; flex:0 0 auto;
  border-radius:50%; overflow:hidden; position:relative;
  box-shadow:0 3px 8px -2px rgba(0,0,0,.5),0 0 0 1px rgba(255,255,255,.06),0 0 0 3px rgba(70,140,120,.25);
}
.char-avatar { width:100%; height:100%; object-fit:cover; display:block; }
.char-avatar.placeholder {
  display:flex; align-items:center; justify-content:center;
  font-size:1.3rem; background:#25353b; color:#7da6b3; font-weight:600;
  width:100%; height:100%;
}
.char-name {
  font-size:1.05rem; font-weight:600; letter-spacing:.4px;
  color:#f4fcff; text-shadow:0 0 4px rgba(255,255,255,0.12);
  max-width:140px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

/* ========== XP BAR ========== */
.kro-xp-bar-container {
  display:flex; align-items:center; gap:.7rem;
  background:linear-gradient(145deg,#21323a,#19262c);
  padding:.65rem .9rem;
  border:1px solid #2e4852;
  border-radius:14px;
  box-shadow:0 4px 16px -4px #041c2133, inset 0 0 0 1px #5fb9ffa8, 0 0 0 1px #29576b;
  position:relative; overflow:hidden;
}
.kro-xp-bar-container::before {
  content:""; position:absolute; inset:0;
  background:radial-gradient(circle at 18% 20%,rgba(255,255,255,0.18),transparent 55%);
  opacity:.22; pointer-events:none; mix-blend-mode:screen;
}
.kro-xp-emblem { font-size:1.4rem; filter:drop-shadow(0 0 4px #50b089); }
.kro-xp-bar {
  flex:1; background:#132126; height:14px;
  border:1px solid #265157; border-radius:30px; position:relative; overflow:hidden;
  box-shadow:inset 0 2px 4px -1px #0007,0 0 0 1px rgba(90,230,180,0.15);
}
.kro-xp-bar-fill {
  background:linear-gradient(90deg,#29a366,#3ce28d,#2fa368);
  height:100%; width:0; border-radius:inherit;
  box-shadow:0 0 6px -1px #40c890,0 0 0 1px rgba(255,255,255,.15),inset 0 0 4px rgba(0,0,0,.45);
  transition:width 420ms cubic-bezier(.4,.2,.15,1); position:relative;
}
.kro-xp-bar-fill::after {
  content:""; position:absolute; inset:0;
  background:linear-gradient(rgba(255,255,255,.35),rgba(255,255,255,0) 65%);
  mix-blend-mode:overlay; opacity:.5;
}
.kro-xp-bar-label {
  font-size:.76rem; font-weight:500; letter-spacing:.5px;
  color:#cfe7f0; text-shadow:0 0 4px rgba(255,255,255,0.15);
}

/* ========== STORYBOX ========== */
.kro-storybox {
  margin-top:1rem; padding:1.05rem 1.1rem;
  border:1px solid var(--border);
  border-radius:14px;
  background:linear-gradient(150deg,#1e2d33,#182327 70%,#141d21);
  box-shadow:0 4px 16px -6px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,0.05);
  position:relative; overflow:hidden;
}
.kro-storybox::before {
  content:""; position:absolute; inset:0;
  background:
    radial-gradient(circle at 78% 26%, rgba(70,180,255,0.1), transparent 50%),
    radial-gradient(circle at 15% 100%, rgba(60,120,255,0.12), transparent 55%);
  pointer-events:none; mix-blend-mode:color-dodge; opacity:.7;
}
.kro-storytitle {
  margin:0 0 .65rem;
  font-size:1.15rem; font-weight:600; letter-spacing:.5px;
  color:#f5fcff; text-shadow:0 0 6px rgba(255,255,255,0.18);
}
.kro-storybody {
  font-size:.84rem; line-height:1.55; color:#d0e1e7;
  letter-spacing:.3px; text-shadow:0 0 3px rgba(255,255,255,0.06);
}

/* ========== PROFIL / MENTORER ========== */
.kro-profilbox {
  display:flex; align-items:center; gap:1rem;
  margin-top:1.3rem; padding:.9rem 1rem;
  background:linear-gradient(135deg,#22333a,#1b272d);
  border:1px solid #2b434c;
  border-radius:14px;
  box-shadow:0 3px 12px -4px rgba(0,0,0,.55),0 0 0 1px rgba(255,255,255,0.04);
}
.kro-xp-header { font-size:.9rem; font-weight:600; letter-spacing:.5px; color:#e0f2f7; text-shadow:0 0 4px rgba(255,255,255,0.1); }

.kro-mentors { margin-top:1.1rem; }
.kro-mentors-row {
  display:flex; flex-wrap:nowrap; gap:16px;
  overflow-x:auto; overflow-y:hidden;
  padding:.35rem .25rem .6rem;
  scrollbar-width:thin;
  scrollbar-color:var(--scrollbar-thumb) var(--scrollbar-track);
  scroll-snap-type:x proximity;
}
.kro-mentors-row::-webkit-scrollbar { height:10px; }
.kro-mentors-row::-webkit-scrollbar-track { background:var(--scrollbar-track); border-radius:30px; }
.kro-mentors-row::-webkit-scrollbar-thumb { background:var(--scrollbar-thumb); border-radius:30px; box-shadow:inset 0 0 0 1px rgba(255,255,255,0.08); }
.kro-mentors-row::-webkit-scrollbar-thumb:hover { background:rgba(255,255,255,0.33); }

.kro-mentorbox {
  flex:0 0 240px; scroll-snap-align:start;
  position:relative;
  border:1px solid #2d4951;
  border-radius:16px;
  background:linear-gradient(160deg,#25353c,#1a262b);
  padding:.95rem 1rem .9rem;
  display:flex; flex-direction:column; gap:.5rem;
  cursor:pointer;
  box-shadow:0 4px 12px -5px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,0.05);
  transition:transform .55s cubic-bezier(.16, .72, .23, 1), box-shadow var(--transition), border-color var(--transition);
  overflow:hidden;
}
.kro-mentorbox:hover {
  transform:translateY(-4px) rotate3d(1,1,0,10deg);
  box-shadow:0 10px 28px -6px rgba(0,0,0,.75),0 0 0 1px rgba(255,255,255,0.08),0 5px 15px -4px rgba(0,140,255,.35), 0 12px 22px -6px rgba(25,180,90,.45);
  border-color:#3d6c5f;
}
.kro-mentorbox::before {
  content:""; position:absolute; inset:-1px;
  border:1px solid rgba(255,255,255,0.08); border-radius:inherit;
  pointer-events:none; mix-blend-mode:overlay; opacity:.8;
}
.kro-mentor-img {
  width:100%; aspect-ratio:16/9; border-radius:12px; object-fit:cover; position:relative; z-index:1;
  box-shadow:0 3px 10px -4px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,0.07), 0 0 0 2px rgba(100,200,150,0.25), 0 0 0 5px rgba(0,0,0,.5), 0 4px 18px -4px #006f5caa, 0 0 12px 2px rgba(255,255,255,0.1);
  background:#182629 linear-gradient(145deg,rgba(35,120,180,0.25),rgba(20,60,40,0.3));
  transform:translateZ(0);
}
.kro-mentor-main {
  font-size:.78rem; font-weight:600; letter-spacing:.5px;
  color:#d9f0f5; text-transform:uppercase; text-shadow:0 0 5px rgba(255,255,255,0.2);
}
.kro-mentor-progressbar {
  display:flex; align-items:center; gap:.5rem;
  background:#162024; border:1px solid #264047;
  border-radius:10px; padding:.4rem .55rem;
  font-size:.65rem; text-shadow:0 0 5px rgba(255,255,255,0.15);
}
.kro-mentor-emblem { font-size:1.15rem; filter:drop-shadow(0 0 4px rgba(255,255,255,0.3)); }
.kro-mentor-bar {
  position:relative; flex:1; height:12px;
  border-radius:30px; background:#1a2c30; border:1px solid #2e5964;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,0.06), 0 2px 8px -3px rgba(0,0,0,.6);
  overflow:hidden; transform-style:preserve-3d; perspective:600px;
}
.kro-mentor-bar::before {
  content:""; position:absolute; inset:0;
  background:repeating-linear-gradient(45deg,rgba(255,255,255,0.09) 0 6px,transparent 6px 12px), radial-gradient(circle at 30% 30%, rgba(0,255,200,0.35), transparent 60%);
  mix-blend-mode:overlay; opacity:.55; pointer-events:none;
}
.kro-mentor-bar-fill {
  position:absolute; inset:0; width:0;
  background:linear-gradient(90deg,#21a892 0%,#1f6bb6 40%,#6a3dc6 70%,#b853e8 100%);
  box-shadow:0 0 0 1px rgba(255,255,255,0.2),0 0 6px -1px #53ffd5, 0 0 30px -5px #53ffd5, 4px 0 30px -8px #8b48ff;
  animation:mentorbarGlow 7s ease-in-out infinite;
  transform:translateZ(0);
}
@keyframes mentorbarGlow {
  0% { filter:brightness(1) contrast(1);}
  50% { filter:brightness(1.15) contrast(1.05);}
  100% { filter:brightness(1) contrast(1);}
}
.kro-mentor-bar-fill::after {
  content:""; position:absolute; inset:0;
  background:linear-gradient(rgba(255,255,255,0.3),rgba(255,255,255,0) 60%), repeating-linear-gradient(90deg,rgba(255,255,255,0.18) 0 12px,rgba(255,255,255,0) 12px 24px);
  mix-blend-mode:overlay; opacity:.5; pointer-events:none;
}
.kro-mentor-bar-label {
  font-size:.72rem; font-weight:600; letter-spacing:.5px;
  color:#c4eef5; text-shadow:0 0 4px rgba(255,255,255,0.2);
}

@media (max-width:800px){
  .kro-mentorbox { flex:0 0 195px; }
  .char-avatar-wrap { width:60px; height:60px; }
}

/* ========== QUESTS (kort) ========== */
.kro-quests { display:grid; gap:1rem; margin-top:.6rem; }
.kro-questroll {
  background:#1c2a31; border:1px solid #2d454d;
  border-radius:14px; padding:.8rem .95rem;
  font-size:.78rem; line-height:1.4; position:relative;
  overflow:hidden; display:flex; flex-direction:column; gap:.45rem;
  box-shadow:0 3px 12px -5px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,0.04);
}
.quest-topline {
  display:flex; align-items:center; gap:.5rem;
  font-weight:600; letter-spacing:.4px; font-size:.85rem;
  text-shadow:0 0 5px rgba(255,255,255,0.15);
}
.quest-rarity {
  font-size:.55rem; text-transform:uppercase; padding:.25rem .45rem;
  border-radius:30px; letter-spacing:1px; font-weight:600;
  border:1px solid rgba(255,255,255,0.12);
  background:#2a2e25; color:#e7e6d8; white-space:nowrap;
  box-shadow:0 0 0 1px rgba(255,255,255,0.07),0 1px 3px -1px rgba(0,0,0,.5);
}
.quest-rarity--uncommon { background:#23402e; color:#b6eccb; }
.quest-rarity--rare { background:#1d2f52; color:#c9dcfa; }
.quest-rarity--epic { background:#4a3516; color:#fadca9; }
.kro-quest-progress { display:flex; gap:.6rem; align-items:center; justify-content:space-between; }
.kro-quest-actions { display:flex; gap:.5rem; flex-wrap:wrap; }

/* ========== KRØNIKE LAUNCHER ========== */
.chronicle-launch {
  position:fixed; right:1rem; bottom:1rem;
  background:#233137; border:1px solid #35515b;
  border-radius:16px; padding:.65rem .85rem;
  cursor:pointer; box-shadow:0 6px 18px -4px rgba(0,0,0,.65),0 0 0 1px rgba(255,255,255,0.06);
  display:flex; align-items:center; gap:.4rem;
  font-size:.8rem; font-weight:600; color:#d4edf4; letter-spacing:.6px;
  text-shadow:0 0 4px rgba(255,255,255,0.12);
  transition:transform .45s cubic-bezier(.16,.8,.25,1), background var(--transition), box-shadow var(--transition), border-color var(--transition);
  z-index:400;
}
.chronicle-launch:hover {
  transform:translateY(-4px) translateZ(0);
  background:#2c4148; border-color:#42717f;
  box-shadow:0 12px 28px -8px rgba(0,0,0,.75),0 0 0 1px rgba(255,255,255,0.1),0 0 4px 2px rgba(90,230,200,0.35);
}

/* ========== PROFILVÆLGER AVATARER ========== */
.profile-select-screen .ps-avatar img {
  width:64px; height:64px; object-fit:cover; border-radius:12px;
}
.ps-avatar-placeholder {
  width:64px; height:64px; display:flex; align-items:center; justify-content:center;
  background:#243238; color:#7aa6b5; border-radius:12px;
  font-weight:600; font-size:1.1rem;
}
.chosen-avatar-img {
  width:96px; height:96px; object-fit:cover; border-radius:18px;
  box-shadow:0 4px 14px -4px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,0.15);
}

/* ========== POPUPS (GENOPRETTET + STØRRE VERTIKALT) ========== */
.lore-overlay-wrap {
  position:fixed;
  inset:0;
  background:rgba(10,14,16,0.72);
  backdrop-filter:blur(6px);
  -webkit-backdrop-filter:blur(6px);
  display:flex;
  align-items:center;
  justify-content:center;
  padding: clamp(1.2rem, 3vh, 2.8rem) clamp(1rem, 2vw, 2.2rem);
  z-index:6000;
  animation:fadeInOverlay .32s ease;
}
.lore-overlay-fade {
  animation:fadeOutOverlay .28s ease forwards;
}
@keyframes fadeInOverlay {
  from { opacity:0; }
  to { opacity:1; }
}
@keyframes fadeOutOverlay {
  from { opacity:1; }
  to { opacity:0; }
}
.lore-popup {
  width: min(840px, 92vw);
  max-height: min(86vh, 1200px);
  background:linear-gradient(160deg,#1d2b30 0%,#111c20 60%,#0e1619 100%);
  border:1px solid #335058;
  border-radius:22px;
  box-shadow:
    0 18px 46px -10px rgba(0,0,0,0.75),
    0 0 0 1px rgba(255,255,255,0.07),
    0 0 18px -4px rgba(70,200,150,0.45),
    0 22px 60px -18px rgba(30,130,255,0.25);
  padding: clamp(1.3rem, 2.2vh, 2.2rem) clamp(1.4rem, 2.8vh, 2.4rem) clamp(1.6rem, 2.5vh, 2.6rem);
  display:flex;
  flex-direction:column;
  position:relative;
  overflow:hidden;
  color:#e5f4f9;
  font-size:0.9rem;
  line-height:1.55;
  letter-spacing:.35px;
}
.lore-popup--arch {
  background:
    linear-gradient(180deg,rgba(0,0,0,0.55),rgba(0,0,0,0.85)),
    var(--arch-bg) center/cover no-repeat;
  backdrop-filter:blur(2px);
  -webkit-backdrop-filter:blur(2px);
}
.lore-popup-appear {
  animation:popupIn .38s cubic-bezier(.16,.8,.3,1);
}
.lore-popup-leave {
  animation:popupOut .25s cubic-bezier(.4,.2,.6,1) forwards;
}
@keyframes popupIn {
  from { opacity:0; transform:translateY(24px) scale(.96); }
  60% { opacity:1; transform:translateY(-4px) scale(1.012); }
  to { opacity:1; transform:translateY(0) scale(1); }
}
@keyframes popupOut {
  from { opacity:1; transform:translateY(0) scale(1); }
  to { opacity:0; transform:translateY(16px) scale(.96); }
}
.lp-close {
  position:absolute;
  top:10px; right:10px;
  width:34px; height:34px;
  border:none;
  background:rgba(0,0,0,0.38);
  color:#d6e9f0;
  cursor:pointer;
  border-radius:14px;
  font:600 0.9rem/1 system-ui;
  display:flex;
  align-items:center;
  justify-content:center;
  backdrop-filter:blur(4px);
  -webkit-backdrop-filter:blur(4px);
  box-shadow:0 2px 8px -2px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,0.08);
  transition:background .25s, transform .3s;
}
.lp-close:hover {
  background:rgba(0,0,0,0.55);
  transform:rotate(8deg) scale(1.05);
}
.lp-top {
  margin-bottom:.8rem;
  padding-right:2.2rem;
}
.lp-title {
  margin:0;
  font-size:1.35rem;
  font-weight:600;
  letter-spacing:.8px;
  text-shadow:0 0 6px rgba(255,255,255,0.25);
  background:linear-gradient(90deg,#e9f9ff,#b8e6ff 50%,#e0f3ff);
  -webkit-background-clip:text;
  color:transparent;
  filter:drop-shadow(0 4px 14px rgba(0,200,255,0.15));
}
.lp-body {
  overflow:auto;
  padding-right:.3rem;
  scrollbar-width:thin;
  scrollbar-color:rgba(255,255,255,0.25) transparent;
  flex:1;
  mask-image:linear-gradient(to bottom, rgba(0,0,0,0) 0, rgba(0,0,0,.75) 12px, #000 40px, #000 calc(100% - 32px), rgba(0,0,0,0) 100%);
}
.lp-body::-webkit-scrollbar { width:10px; }
.lp-body::-webkit-scrollbar-track { background:transparent; }
.lp-body::-webkit-scrollbar-thumb {
  background:linear-gradient(180deg,#27454f,#1a3037);
  border:1px solid #3d5d66;
  border-radius:20px;
  box-shadow:0 0 0 1px rgba(255,255,255,0.08), inset 0 0 8px rgba(0,0,0,0.6);
}
.lp-body::-webkit-scrollbar-thumb:hover {
  background:linear-gradient(180deg,#315865,#223c44);
}
.lp-body p {
  margin:0 0 1rem;
  font-size:.9rem;
  line-height:1.6;
}
.lp-body p:last-child { margin-bottom:0; }
.lp-body .lp-major {
  font-size:1rem;
  line-height:1.7;
  background:linear-gradient(90deg,#c2f9ff,#91dfe8 50%,#c2f9ff);
  -webkit-background-clip:text;
  color:transparent;
  text-shadow:0 0 8px rgba(160,255,255,0.15);
  font-weight:500;
}
.lp-body .lp-minor-frag {
  font-size:.92rem;
  font-style:italic;
  color:#d0edf2;
  opacity:.95;
  position:relative;
  padding-left:.8rem;
}
.lp-body .lp-minor-frag::before {
  content:"“"; position:absolute; left:0; top:-2px; color:#7ed6e0; font-weight:600;
}
.lp-actions {
  margin-top:1rem;
  display:flex;
  justify-content:flex-end;
  gap:.75rem;
  padding-top:.9rem;
  border-top:1px solid rgba(255,255,255,0.08);
}
.lore-popup--major .lp-title {
  background:linear-gradient(90deg,#ffe7a6,#ffd277,#ffefc1);
  -webkit-background-clip:text;
  color:transparent;
}
.lore-popup--major .lp-body .lp-major {
  background:linear-gradient(90deg,#ffe8aa,#ffd277 55%,#ffe8aa);
  -webkit-background-clip:text;
  color:transparent;
}
.lore-popup--minor .lp-title {
  background:linear-gradient(90deg,#c0fff3,#88e3e0 50%,#c0fff3);
  -webkit-background-clip:text;
  color:transparent;
}
@media (max-width:680px){
  .lore-popup {
    width:94vw;
    max-height:88vh;
    padding:1.15rem 1.2rem 1.55rem;
    border-radius:18px;
  }
  .lp-title { font-size:1.18rem; }
  .lp-body { font-size:.86rem; }
}

/* ========== SCROLLBARS GLOBALT ========== */
::-webkit-scrollbar { width:10px; }
::-webkit-scrollbar-track { background:var(--scrollbar-track); }
::-webkit-scrollbar-thumb { background:var(--scrollbar-thumb); border-radius:6px; }
::-webkit-scrollbar-thumb:hover { background:rgba(255,255,255,0.34); }

/* ========== RESPONSIVE SMALL ========== */
@media (max-width:600px){
  .char-avatar-wrap { width:56px; height:56px; }
  .kro-mentorbox { flex:0 0 185px; }
  .kro-header { font-size:1rem; }
}

/* === FIX: Mentor-kort fuldt synlige og quests i grid på hovedvisningen ===
   Minimal ændring: Overstyr kun på #main-view så andre visninger (fx krønike) kan beholde egne layouts.
   Ingen eksisterende klasser fjernet eller JS påvirket.
*/
#main-view .kro-mentors-row {
  flex-wrap:wrap;
  overflow:visible;
  padding:.35rem 0 .6rem;
  scroll-snap-type:none;
}
#main-view .kro-mentorbox {
  flex:1 1 220px;
  max-width:240px;
}
#main-view .kro-quests {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:1rem;
  align-items:start;
}
#chronicle-view .kro-quests {
  display:flex;
  flex-direction:column;
  gap:.75rem;
}
